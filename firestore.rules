rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /accessKeys/{accessKeyId} {
      // Allow reading a key document if authenticated. This is needed for the login page.
      // This rule allows a specific query to check for a key's existence.
      allow read: if request.auth != null;

      // Disallow listing all documents for non-admins.
      allow list: if false;
      
      // Allow creating a new key document if authenticated (for seeding).
      allow create: if request.auth != null;
      
      // Allow updating a key document (e.g., to set deviceId or rewards)
      // if authenticated.
      allow update: if request.auth != null;

      // Deleting keys should be an admin-only action.
      allow delete: if false;
    }
  }
}
